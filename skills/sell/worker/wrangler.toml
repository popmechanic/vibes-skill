# Cloudflare Worker configuration for __APP_NAME__
#
# Prerequisites:
#   1. Create KV namespace: wrangler kv namespace create TENANTS
#   2. Copy the namespace ID below
#   3. Update PAGES_HOSTNAME with your Pages project URL
#   4. Deploy: wrangler deploy
#   5. Set secret: wrangler secret put CLERK_SECRET_KEY

name = "__WORKER_NAME__"
main = "worker.js"
compatibility_date = "2024-12-01"

[vars]
PAGES_HOSTNAME = "__PAGES_PROJECT__.pages.dev"
APP_DOMAIN = "__APP_DOMAIN__"

# IMPORTANT: Create a NEW KV namespace for EACH deployment!
# Do NOT reuse KV namespaces across different domains.
# Create with: wrangler kv namespace create TENANTS
# Then copy the ID below
[[kv_namespaces]]
binding = "TENANTS"
id = "YOUR_KV_NAMESPACE_ID"

# Routes for wildcard subdomains, API, and webhooks
# NOTE: If routes don't apply after deploy, add manually in Cloudflare Dashboard:
#   Workers & Pages > __WORKER_NAME__ > Settings > Triggers > Routes
routes = [
  { pattern = "*.__APP_DOMAIN__/*", zone_name = "__APP_DOMAIN__" },
  { pattern = "__APP_DOMAIN__/api/*", zone_name = "__APP_DOMAIN__" },
  { pattern = "__APP_DOMAIN__/webhooks/*", zone_name = "__APP_DOMAIN__" }
]
