<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>__APP_TITLE__</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      :root {
        /* Core colors */
        --vibes-black: #0f172a;
        --vibes-white: #ffffff;
        --vibes-near-black: #1a1a1a;
        --vibes-cream: #fffff0;

        /* Gray scale */
        --vibes-gray-lightest: #f1f5f9;
        --vibes-gray-ultralight: #f8fafc;

        /* Menu colors */
        --vibes-menu-bg: #CCCDC8;
        --vibes-menu-grid: rgba(255, 255, 255, 0.5);

        /* Button variant colors */
        --vibes-variant-blue: #009ACE;
        --vibes-variant-red: #DA291C;
        --vibes-variant-yellow: #DA291C;
        --vibes-variant-gray: #6b7280;

        /* Button styling */
        --vibes-button-bg: var(--vibes-cream);
        --vibes-button-text: var(--vibes-near-black);
        --vibes-button-border: var(--vibes-near-black);
        --vibes-button-icon-bg: #fff;
        --vibes-button-icon-fill: #2a2a2a;

        /* Landing page theming (customize these for brand) */
        --landing-accent: #0f172a;
        --landing-accent-hover: #1e293b;

        /* Admin dashboard theming (inherits from app, override via CSS) */
        --admin-bg: oklch(0.97 0.01 250);
        --admin-card-bg: white;
        --admin-text: #0f172a;
        --admin-text-muted: #64748b;
        --admin-accent: oklch(0.6 0.2 145);
        --admin-border: #0f172a;
        --admin-shadow: #0f172a;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      #container {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <!-- NOTE: @clerk/clerk-react uses direct URL in import statement because
         Babel standalone doesn't properly resolve import maps for bare specifiers -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react-dom": "https://esm.sh/react-dom@18.3.1?deps=react@18.3.1",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client?deps=react@18.3.1",
          "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
          "use-fireproof": "https://esm.sh/use-fireproof@0.20.0-dev-preview-50?deps=react@18.3.1",
          "use-vibes": "https://esm.sh/use-vibes@0.18.9?deps=react@18.3.1"
        }
      }
    </script>
    <!-- Load React globally for menu components -->
    <script type="module">
      import * as React from "react";
      window.React = React;

      // === START VibesSwitch ===
const switchColors = {
  primary: "var(--vibes-black)",
  secondary: "var(--vibes-white)"
};

function VibesSwitch({
  size = 24,
  className,
  isActive,
  onToggle
}) {
  const [internalActive, setInternalActive] = React.useState(true);
  const logicalActive = isActive !== void 0 ? isActive : internalActive;
  const active = !logicalActive;
  const handlePointerDown = (e) => {
    e.stopPropagation();
    e.preventDefault();
    const newState = !logicalActive;
    if (onToggle) {
      onToggle(newState);
    }
    if (isActive === void 0) {
      setInternalActive(newState);
    }
  };
  const originalD = `M426.866,285.985c-7.999-0.416-19.597-0.733-31.141-1.687  c-15.692-1.297-28.809-8.481-40.105-19.104c-12.77-12.008-20.478-26.828-22.714-44.177c-3.048-23.644,3.384-44.558,19.646-62.143  c9.174-9.92,20.248-17.25,33.444-20.363c7.786-1.837,15.944-2.399,23.973-2.828c9.988-0.535,20.023-0.666,30.021-0.371  c10.191,0.301,20.433,0.806,30.521,2.175c12.493,1.696,23.132,7.919,32.552,16.091c14.221,12.337,22.777,27.953,25.184,46.594  c2.822,21.859-2.605,41.617-16.777,58.695c-9.494,11.441-21.349,19.648-35.722,23.502c-6.656,1.785-13.724,2.278-20.647,2.77  C446.914,285.721,438.682,285.667,426.866,285.985z`;
  const stretchedD = `M165.866,285.985c-7.999-0.416-19.597-0.733-31.141-1.687  c-15.692-1.297-28.809-8.481-40.105-19.104c-12.77-12.008-20.478-26.828-22.714-44.177c-3.048-23.644,3.384-44.558,19.646-62.143  c9.174-9.92,20.248-17.25,33.444-20.363c7.786-1.837,15.944-2.399,23.973-2.828c9.988-0.535,121.023-0.666,131.021-0.371  c10.191,0.301,20.433,0.806,30.521,2.175c12.493,1.696,23.132,7.919,32.552,16.091c14.221,12.337,22.777,27.953,25.184,46.594  c2.822,21.859-2.605,41.617-16.777,58.695c-9.494,11.441-21.349,19.648-35.722,23.502c-6.656,1.785-13.724,2.278-20.647,2.77  C286.914,285.721,177.682,285.667,165.866,285.985z`;
  return /* @__PURE__ */ React.createElement(
    "svg",
    {
      xmlns: "http://www.w3.org/2000/svg",
      height: size,
      viewBox: "0 0 600 300",
      fill: "currentColor",
      className,
      onPointerDown: handlePointerDown
    },
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        fill: "#000",
        d: "M293.353,298.09c-41.038,0-82.078,0.125-123.115-0.077  c-11.993-0.06-24.011-0.701-35.964-1.703c-15.871-1.331-29.73-7.937-41.948-17.946c-16.769-13.736-27.207-31.417-30.983-52.7  c-4.424-24.93,1.404-47.685,16.506-67.913c11.502-15.407,26.564-26.1,45.258-30.884c7.615-1.949,15.631-2.91,23.501-3.165  c20.08-0.652,40.179-0.853,60.271-0.879c69.503-0.094,139.007-0.106,208.51,0.02c14.765,0.026,29.583,0.097,44.28,1.313  c36.984,3.059,61.78,23.095,74.653,57.301c17.011,45.199-8.414,96.835-54.29,111.864c-7.919,2.595-16.165,3.721-24.434,3.871  c-25.614,0.467-51.234,0.742-76.853,0.867C350.282,298.197,321.817,298.09,293.353,298.09z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fill: "#fff",
        fillRule: "evenodd",
        clipRule: "evenodd",
        d: active ? stretchedD : originalD,
        style: {
          transition: "d 0.3s ease, transform 0.8s ease, fill 2s ease",
          transform: active ? "translateX(3px) " : "none"
        }
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 0.5s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M181.891,205.861c0-5.043-0.001-10.086,0-15.129  c0.001-5.046,1.679-7.539,6.606-7.695c9.292-0.294,18.653-1.051,27.888,0.707c7.614,1.449,11.523,5.954,11.902,13.446  c0.066,1.312-0.313,2.752-0.857,3.966c-1.401,3.123-1.399,6.266-0.673,9.507c0.301,1.342,0.443,2.723,0.787,4.053  c1.274,4.925-1.78,10.114-6.085,11.937c-3.111,1.318-6.561,2.327-9.909,2.497c-7.303,0.37-14.639,0.136-21.96,0.101  c-1.165-0.005-2.345-0.181-3.488-0.422c-2.657-0.56-4.162-2.962-4.197-6.801C181.854,216.639,181.891,211.25,181.891,205.861z   M204.442,192.385c-2.757,0-5.514,0-8.271,0c-3.695,0-5.151,1.669-4.712,5.403c0.369,3.14,1.05,3.735,4.225,3.737  c5.024,0.004,10.05,0.109,15.07-0.014c2.028-0.05,4.167-0.27,6.04-0.98c3.182-1.207,3.639-4.256,1.008-6.455  c-1.073-0.896-2.659-1.509-4.06-1.618C210.659,192.22,207.544,192.385,204.442,192.385z M204.334,211.104c0,0.045,0,0.091,0,0.137  c-3.101,0-6.203-0.055-9.302,0.037c-0.823,0.024-2.257,0.373-2.344,0.794c-0.447,2.154-0.959,4.444-0.639,6.563  c0.276,1.822,2.447,1.451,3.882,1.441c5.989-0.042,11.98-0.118,17.961-0.385c1.416-0.063,2.859-0.79,4.176-1.441  c1.79-0.886,1.833-2.475,1.029-4.046c-1.166-2.276-3.297-3.024-5.677-3.081C210.394,211.049,207.363,211.104,204.334,211.104z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 0.8s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M291.409,229.748c-3.621-0.394-7.838-0.587-11.94-1.379  c-3.577-0.69-6.343-2.991-8.213-6.163c-1.763-2.99-0.301-5.6,3.139-5.292c2.287,0.205,4.512,1.129,6.758,1.755  c6.281,1.751,12.643,1.892,19.053,0.951c0.667-0.098,1.31-0.416,1.941-0.686c1.502-0.644,2.55-1.682,2.581-3.415  c0.031-1.74-1.195-2.749-2.579-3.132c-2.298-0.637-4.688-1.021-7.065-1.273c-5.062-0.536-10.252-0.401-15.187-1.475  c-9.677-2.105-11.678-10.53-10.101-16.009c1.62-5.625,5.911-8.92,11.318-9.73c8.388-1.257,16.925-1.491,25.279,0.654  c3.702,0.951,6.615,3.072,7.883,6.931c0.918,2.792-0.332,4.6-3.268,4.357c-1.684-0.139-3.367-0.676-4.974-1.248  c-6.711-2.387-13.572-2.897-20.569-1.783c-1.001,0.159-2.146,0.414-2.875,1.034c-0.901,0.766-2.016,1.981-1.98,2.964  c0.041,1.128,0.995,2.733,1.991,3.206c1.81,0.857,3.925,1.279,5.948,1.441c5.152,0.41,10.356,0.296,15.479,0.905  c7.98,0.949,13.779,9.833,11.241,17.125c-1.959,5.628-6.44,8.489-12.143,9.322C299.455,229.344,295.715,229.419,291.409,229.748z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1.2s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M235.786,208.14c0-6.905-0.01-13.809,0.004-20.714  c0.007-3.474,0.948-4.428,4.415-3.758c6.62,1.279,13.232,2.651,19.759,4.331c1.7,0.438,3.404,1.896,4.515,3.341  c1.777,2.31,0.433,5.367-2.463,5.745c-1.86,0.243-3.819-0.138-5.717-0.368c-2.183-0.264-4.339-0.783-6.525-0.976  c-1.572-0.138-3.065,0.375-3.8,1.959c-0.76,1.638-0.319,3.329,0.942,4.34c1.619,1.296,3.522,2.327,5.447,3.128  c2.146,0.894,4.539,1.207,6.66,2.145c1.446,0.64,2.982,1.687,3.786,2.981c0.689,1.11,0.928,3.094,0.378,4.202  c-0.492,0.991-2.32,1.795-3.579,1.825c-2.238,0.052-4.483-0.652-6.741-0.832c-1.614-0.127-3.333-0.203-4.865,0.212  c-2.574,0.699-3.225,3.013-1.719,5.218c1.396,2.044,3.431,3.141,5.757,3.761c2.791,0.744,5.637,1.315,8.373,2.222  c3.19,1.058,4.791,3.496,4.801,6.723c0.011,3.365-1.759,5.021-5.138,4.424c-4.402-0.778-8.759-1.81-13.134-2.735  c-2.357-0.499-4.718-0.981-7.069-1.511c-3.263-0.737-4.132-1.805-4.141-5.154c-0.019-6.836-0.006-13.672-0.006-20.508  C235.747,208.141,235.766,208.14,235.786,208.14z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 0.6s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M135.138,229.842c-2.941-0.084-5.296-1.462-6.684-3.9  c-1.827-3.21-3.328-6.618-4.81-10.011c-3.55-8.128-7.021-16.291-10.486-24.455c-0.48-1.132-0.902-2.329-1.087-3.536  c-0.417-2.72,1.238-4.585,3.938-4.119c1.591,0.275,3.569,0.98,4.45,2.173c2.226,3.015,4.175,6.299,5.784,9.69  c2.208,4.654,3.898,9.552,6.032,14.244c0.628,1.379,2.009,2.416,3.045,3.609c0.892-1.159,2.042-2.201,2.63-3.498  c2.697-5.953,5.22-11.985,7.841-17.974c1.423-3.252,3.089-6.418,6.532-7.905c1.238-0.535,3.012-0.712,4.184-0.214  c0.81,0.344,1.377,2.126,1.385,3.271c0.009,1.458-0.479,2.997-1.059,4.371c-4.227,10.013-8.504,20.005-12.833,29.974  c-0.79,1.819-1.762,3.589-2.875,5.229C139.73,228.848,137.671,229.894,135.138,229.842z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1.3s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M164.636,206.263c0-6.691,0.054-13.383-0.036-20.073  c-0.024-1.851,0.716-2.67,2.449-2.81c0.274-0.022,0.549-0.054,0.823-0.076c5.488-0.445,6.091,0.105,6.091,5.562  c0,12.348,0,24.695,0,37.043c0,2.887-0.354,3.405-3.222,3.618c-1.628,0.121-3.338-0.001-4.91-0.408  c-0.593-0.153-1.265-1.408-1.278-2.171c-0.096-5.584-0.034-11.172-0.022-16.759c0.002-1.308,0-2.617,0-3.926  C164.566,206.263,164.601,206.263,164.636,206.263z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M388.313,210.147c0-6.356,0.034-12.713-0.023-19.069  c-0.015-1.61,0.359-2.472,2.19-2.346c2.887,0.198,5.809,0.045,8.671,0.398c4.396,0.542,8.019,4.294,8.144,8.904  c0.223,8.142,0.265,16.304-0.074,24.439c-0.248,5.945-4.552,9.662-10.491,9.831c-1.999,0.057-4.003-0.081-6.006-0.09  c-1.746-0.008-2.439-0.853-2.428-2.584C388.34,223.136,388.313,216.642,388.313,210.147z M393.418,210.324c-0.037,0-0.075,0-0.114,0  c0,4.55-0.038,9.101,0.015,13.65c0.031,2.688,0.926,3.439,3.56,3.239c3.273-0.248,5.493-2.511,5.534-6.04  c0.082-7.099,0.054-14.2-0.033-21.299c-0.041-3.268-1.739-5.241-4.87-6.092c-2.68-0.728-4.025,0.161-4.07,2.896  C393.364,201.226,393.418,205.775,393.418,210.324z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M478.079,200.8c0.674-1.566,1.121-2.53,1.506-3.519  c0.673-1.73,1.252-3.5,1.981-5.205c0.315-0.737,0.766-1.654,1.407-1.961c1.094-0.523,2.388-0.63,3.598-0.912  c0.205,1.142,0.798,2.381,0.537,3.404c-0.606,2.388-1.448,4.756-2.507,6.984c-3.981,8.389-4.352,17.254-3.78,26.282  c0.091,1.438,0.031,2.899-0.105,4.335c-0.14,1.473-0.989,2.428-2.542,2.497c-1.514,0.067-2.311-0.903-2.54-2.23  c-0.232-1.348-0.394-2.754-0.277-4.108c0.94-10.972-1.116-21.38-5.626-31.375c-0.586-1.298-0.899-2.762-1.093-4.183  c-0.233-1.712,0.825-2.592,2.379-1.843c1.164,0.561,2.345,1.55,2.973,2.657c1.078,1.897,1.712,4.043,2.568,6.07  C476.918,198.547,477.37,199.361,478.079,200.8z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M440.516,210.627c0,6.281,0.007,12.563-0.004,18.844  c-0.004,2.067-0.805,3.038-2.531,3.015c-1.877-0.025-2.365-1.136-2.359-2.876c0.046-12.631,0.019-25.263,0.029-37.895  c0.002-2.592,0.525-3.205,2.419-3.148c1.856,0.057,2.479,1.03,2.466,2.803C440.484,197.788,440.515,204.208,440.516,210.627z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M416.875,210.721c0.068-3.305,1.849-5.306,4.727-5.309  c2.765-0.003,4.924,2.404,4.816,5.371c-0.106,2.956-2.355,5.212-5.12,5.138C418.626,215.849,416.813,213.718,416.875,210.721z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M449.933,210.636c0.102-3.331,1.886-5.279,4.778-5.22  c2.67,0.055,4.829,2.432,4.762,5.243c-0.073,3.021-2.404,5.36-5.242,5.261C451.606,215.829,449.84,213.657,449.933,210.636z"
      }
    )
  );
}
// === END VibesSwitch ===

      // === START HiddenMenuWrapper ===
if (typeof document !== "undefined") {
  const styleId = "hidden-menu-wrapper-vars";
  if (!document.getElementById(styleId)) {
    const style = document.createElement("style");
    style.id = styleId;
    style.textContent = `
      :root {
        --hm-menu-bg: var(--vibes-gray-lightest);
        --hm-menu-text: var(--vibes-white);
        --hm-content-bg: #1e1e1e;
        --hm-shadow: rgba(0, 0, 0, 0.3);
        --hm-grid-line: rgba(255, 255, 255, 0.5);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --hm-menu-bg: #2a2a2a;
          --hm-menu-text: var(--vibes-gray-ultralight);
          --hm-content-bg: var(--vibes-near-black);
          --hm-shadow: rgba(255, 255, 255, 0.1);
        }
      }
    `;
    document.head.appendChild(style);
  }
}
const hiddenMenuTheme = {
  colors: {
    menuBg: "var(--hm-menu-bg, var(--vibes-gray-lightest))",
    menuText: "var(--hm-menu-text, var(--vibes-white))",
    contentBg: "var(--hm-content-bg, #1e1e1e)",
    shadow: "var(--hm-shadow, rgba(0, 0, 0, 0.3))",
    gridLineColor: "var(--hm-grid-line, rgba(255, 255, 255, 0.5))"
  },
  zIndex: {
    menu: 5,
    content: 10,
    toggle: 20
  },
  dimensions: {
    gridSize: "40px",
    padding: "24px",
    bottomOffset: "16px"
  },
  animation: {
    duration: "0.4s",
    easing: "ease",
    blurAmount: "4px"
  }
};
const getWrapperStyle = () => ({
  position: "relative",
  overflow: "hidden"
});
const getMenuStyle = () => ({
  position: "fixed",
  bottom: 0,
  left: 0,
  right: 0,
  zIndex: hiddenMenuTheme.zIndex.menu,
  color: hiddenMenuTheme.colors.menuText,
  padding: hiddenMenuTheme.dimensions.padding,
  boxShadow: `0 -2px 10px ${hiddenMenuTheme.colors.shadow}`,
  backgroundColor: hiddenMenuTheme.colors.menuBg,
  backgroundImage: `
    linear-gradient(${hiddenMenuTheme.colors.gridLineColor} 1px, transparent 1px),
    linear-gradient(90deg, ${hiddenMenuTheme.colors.gridLineColor} 1px, transparent 1px)
  `,
  backgroundSize: hiddenMenuTheme.dimensions.gridSize + " " + hiddenMenuTheme.dimensions.gridSize
});
const getContentStyle = () => ({
  filter: "none",
  width: "100%",
  height: "100%"
});
const getContentWrapperStyle = (menuHeight, menuOpen, isBouncing) => ({
  position: "fixed",
  top: 0,
  left: 0,
  right: 0,
  bottom: 0,
  zIndex: hiddenMenuTheme.zIndex.content,
  transition: isBouncing ? `filter 0.3s ${hiddenMenuTheme.animation.easing}` : `transform ${hiddenMenuTheme.animation.duration} ${hiddenMenuTheme.animation.easing}, filter 0.3s ${hiddenMenuTheme.animation.easing}`,
  transform: menuOpen ? `translateY(-${menuHeight}px)` : "translateY(0)",
  overflowY: "auto",
  borderTopColor: hiddenMenuTheme.colors.menuBg,
  borderTopWidth: "1px",
  borderTopStyle: "solid",
  boxShadow: `0 -2px 10px ${hiddenMenuTheme.colors.shadow}`,
  backgroundColor: hiddenMenuTheme.colors.contentBg,
  animation: isBouncing ? "vibes-drop-to-close 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)" : void 0,
  willChange: isBouncing ? "transform" : void 0
});
const getInnerContentWrapperStyle = (menuOpen) => ({
  filter: menuOpen ? `blur(${hiddenMenuTheme.animation.blurAmount})` : "none",
  width: "100%",
  height: "100%"
});
const getToggleButtonStyle = () => ({
  position: "fixed",
  bottom: hiddenMenuTheme.dimensions.bottomOffset,
  right: 0,
  zIndex: hiddenMenuTheme.zIndex.toggle,
  backgroundColor: "transparent",
  border: "none",
  cursor: "pointer"
});

function HiddenMenuWrapper({
  children,
  menuContent,
  triggerBounce,
  showVibesSwitch = true
}) {
  const [menuOpen, setMenuOpen] = React.useState(false);
  const [menuHeight, setMenuHeight] = React.useState(0);
  const menuRef = React.useRef(null);
  const buttonRef = React.useRef(null);
  const menuContainerRef = React.useRef(null);
  const rafIdRef = React.useRef(null);
  const cancelRef = React.useRef(null);
  const [isBouncing, setIsBouncing] = React.useState(false);
  const [hasBouncedOnMount, setHasBouncedOnMount] = React.useState(false);
  React.useEffect(() => {
    if (!hasBouncedOnMount && !menuOpen) {
      const prefersReducedMotion = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches || false;
      if (!prefersReducedMotion) {
        setIsBouncing(true);
        setTimeout(() => setIsBouncing(false), 800);
      }
      setHasBouncedOnMount(true);
    }
  }, [hasBouncedOnMount, menuOpen]);
  React.useEffect(() => {
    const styleId = "vibes-drop-to-close-keyframes";
    const existingStyle = document.getElementById(styleId);
    if (!existingStyle) {
      const style = document.createElement("style");
      style.id = styleId;
      style.textContent = `
        @keyframes vibes-drop-to-close {
          0%   { transform: translateY(-400px); }  /* Start pushed up */
          10%  { transform: translateY(0); }       /* First big drop */
          25%  { transform: translateY(-175px); }   /* First bounce back up */
          35%  { transform: translateY(0); }       /* Second drop */
          48%  { transform: translateY(-75px); }   /* Second bounce back up */
          62%  { transform: translateY(0); }       /* Third drop */
          72%  { transform: translateY(-25px); }   /* Third bounce back up */
          80%  { transform: translateY(0); }       /* Fourth drop - faster */
          82%  { transform: translateY(-10px); }   /* Fourth bounce back up - much faster */
          88%  { transform: translateY(0); }       /* Fifth drop */
          91%  { transform: translateY(-5px); }    /* Final tiny bounce back up */
          95%  { transform: translateY(0); }       /* Final settle */
          100% { transform: translateY(0); }
        }
      `;
      document.head.appendChild(style);
    }
  }, []);
  React.useEffect(() => {
    if (triggerBounce) {
      setIsBouncing(true);
      const timeout = setTimeout(() => setIsBouncing(false), 800);
      return () => clearTimeout(timeout);
    }
  }, [triggerBounce]);
  React.useEffect(() => {
    if (menuRef.current) {
      const next = menuRef.current.offsetHeight;
      setMenuHeight((prev) => prev !== next ? next : prev);
    }
  }, [menuContent]);
  React.useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === "Escape" && menuOpen) {
        setMenuOpen(false);
        buttonRef.current?.focus();
      }
      if (menuOpen && e.key === "Tab" && menuContainerRef.current) {
        const focusableElements = menuContainerRef.current.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        const first = focusableElements[0];
        const last = focusableElements[focusableElements.length - 1];
        if (!first || !last) return;
        if (e.shiftKey) {
          if (document.activeElement === first) {
            e.preventDefault();
            last.focus();
          }
        } else {
          if (document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }
    };
    document.addEventListener("keydown", handleKeyDown);
    return () => document.removeEventListener("keydown", handleKeyDown);
  }, [menuOpen]);
  React.useEffect(() => {
    if (menuOpen) {
      const firstFocusable = menuRef.current?.querySelector(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      firstFocusable?.focus();
    }
  }, [menuOpen]);
  const useIsomorphicLayoutEffect = typeof window !== "undefined" ? React.useLayoutEffect : useEffect;
  useIsomorphicLayoutEffect(() => {
    const menuEl = menuRef.current;
    if (!menuEl) return;
    const scheduleSetHeight = (h) => {
      if (rafIdRef.current != null && cancelRef.current) {
        cancelRef.current(rafIdRef.current);
        rafIdRef.current = null;
      }
      const run = () => setMenuHeight((prev) => prev !== h ? h : prev);
      if (typeof requestAnimationFrame !== "undefined") {
        const id = requestAnimationFrame(() => run());
        rafIdRef.current = id;
        cancelRef.current = (cancelId) => cancelAnimationFrame(cancelId);
      } else {
        const id = setTimeout(run, 0);
        rafIdRef.current = id;
        cancelRef.current = (cancelId) => clearTimeout(cancelId);
      }
    };
    scheduleSetHeight(menuEl.offsetHeight);
    if (typeof window.ResizeObserver !== "undefined") {
      const RO = window.ResizeObserver;
      const resizeObserver = new RO(() => {
        scheduleSetHeight(menuEl.offsetHeight);
      });
      resizeObserver.observe(menuEl);
      return () => {
        resizeObserver.disconnect();
        if (rafIdRef.current != null && cancelRef.current) {
          cancelRef.current(rafIdRef.current);
          rafIdRef.current = null;
        }
      };
    }
    const mutationObserver = new MutationObserver(() => {
      scheduleSetHeight(menuEl.offsetHeight);
    });
    mutationObserver.observe(menuEl, { childList: true, subtree: true });
    const onResize = () => scheduleSetHeight(menuEl.offsetHeight);
    window.addEventListener("resize", onResize);
    window.addEventListener("orientationchange", onResize);
    return () => {
      mutationObserver.disconnect();
      window.removeEventListener("resize", onResize);
      window.removeEventListener("orientationchange", onResize);
      if (rafIdRef.current != null && cancelRef.current) {
        cancelRef.current(rafIdRef.current);
        rafIdRef.current = null;
      }
    };
  }, []);
  React.useEffect(() => {
    const menuEl = menuRef.current;
    if (!menuEl) return;
    const defer = (cb) => {
      if (typeof queueMicrotask === "function") {
        queueMicrotask(cb);
      } else if (typeof requestAnimationFrame !== "undefined") {
        requestAnimationFrame(cb);
      } else {
        setTimeout(cb, 0);
      }
    };
    defer(() => {
      const next = menuEl.offsetHeight;
      setMenuHeight((prev) => prev !== next ? next : prev);
    });
  }, [menuOpen]);
  return /* @__PURE__ */ React.createElement("div", { style: getWrapperStyle() }, /* @__PURE__ */ React.createElement(
    "div",
    {
      id: "hidden-menu",
      role: "dialog",
      "aria-modal": "true",
      "aria-label": "Hidden menu",
      "aria-hidden": !menuOpen,
      ref: menuRef,
      style: getMenuStyle()
    },
    menuContent
  ), /* @__PURE__ */ React.createElement(
    "div",
    {
      style: getContentWrapperStyle(menuHeight, menuOpen, isBouncing),
      ref: menuContainerRef
    },
    /* @__PURE__ */ React.createElement("div", { style: getInnerContentWrapperStyle(menuOpen) }, /* @__PURE__ */ React.createElement("div", { style: getContentStyle() }, children))
  ), showVibesSwitch && /* @__PURE__ */ React.createElement(
    "button",
    {
      "aria-haspopup": "dialog",
      "aria-expanded": menuOpen,
      "aria-controls": "hidden-menu",
      ref: buttonRef,
      onClick: () => setMenuOpen(!menuOpen),
      style: getToggleButtonStyle()
    },
    /* @__PURE__ */ React.createElement(VibesSwitch, { size: 80 })
  ));
}
// === END HiddenMenuWrapper ===

      // === START VibesButton ===
const variantColors = {
  blue: "var(--vibes-variant-blue)",
  red: "var(--vibes-variant-red)",
  yellow: "var(--vibes-variant-yellow)",
  gray: "var(--vibes-variant-gray)"
};
function getVariantColor(variant) {
  return variantColors[variant] || variant;
}
const bounceKeyframes = `
  @keyframes vibes-button-bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-8px);
    }
  }
`;
function getButtonStyle(variant, isHovered, isActive, isMobile = false, hasIcon) {
  const cssColor = getVariantColor(variant);
  let transform = "translate(0px, 0px)";
  let boxShadow = `8px 10px 0px 0px ${cssColor}, 8px 10px 0px 2px var(--vibes-button-border)`;
  if (isHovered && !isActive) {
    transform = "translate(2px, 2px)";
    boxShadow = `2px 3px 0px 0px ${cssColor}, 2px 3px 0px 2px var(--vibes-button-border)`;
  }
  if (isActive) {
    transform = "translate(4px, 5px)";
    boxShadow = "none";
  }
  return {
    width: !hasIcon ? "auto" : isMobile ? "100%" : "150px",
    height: !hasIcon ? "auto" : isMobile ? "auto" : "150px",
    minHeight: isMobile ? "60px" : void 0,
    padding: isMobile ? "0.75rem 1.5rem" : "1rem 2rem",
    borderRadius: "12px",
    fontSize: "1rem",
    fontWeight: 700,
    textTransform: "uppercase",
    letterSpacing: "0.05em",
    cursor: "pointer",
    transition: "all 0.15s ease",
    position: "relative",
    transform,
    boxShadow
  };
}
function getMergedButtonStyle(baseStyle, ignoreDarkMode, customStyle) {
  return {
    ...baseStyle,
    background: ignoreDarkMode ? "var(--vibes-button-bg)" : "var(--vibes-button-bg-dark-aware)",
    color: ignoreDarkMode ? "var(--vibes-button-text)" : "var(--vibes-button-text-dark-aware)",
    border: ignoreDarkMode ? "2px solid var(--vibes-button-border)" : "2px solid var(--vibes-button-border-dark-aware)",
    ...customStyle
  };
}
function getIconContainerStyle(variant, isMobile, hasIcon) {
  if (!hasIcon) return {};
  const cssColor = getVariantColor(variant);
  return {
    width: isMobile ? "48px" : "80px",
    height: isMobile ? "48px" : "80px",
    backgroundColor: cssColor,
    borderRadius: "8px",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    flexShrink: 0,
    border: "2px solid var(--vibes-black)"
  };
}
function getIconStyle(isMobile, isHovered, isActive) {
  return {
    width: isMobile ? "28px" : "50px",
    height: isMobile ? "28px" : "50px",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    animation: isHovered && !isActive ? "vibes-button-bounce 0.8s ease-in-out infinite" : "none"
  };
}
function getButtonContentWrapperStyle(isMobile, hasIcon) {
  if (!hasIcon) return {};
  return {
    display: "flex",
    alignItems: "center",
    gap: isMobile ? "16px" : "6px",
    flexDirection: isMobile ? "row" : "column",
    justifyContent: isMobile ? "flex-start" : "center",
    width: "100%"
  };
}

const BLUE = "blue";
const RED = "red";
const YELLOW = "yellow";
const GRAY = "gray";
const iconMap = {
  login: LoginIcon,
  remix: RemixIcon,
  invite: InviteIcon,
  settings: SettingsIcon,
  back: BackIcon
};
function VibesButton({
  variant = "blue",
  children,
  onHover,
  onUnhover,
  icon,
  style: customStyle,
  className = "",
  ignoreDarkMode = false,
  ...props
}) {
  const buttonVariant = variant;
  const [isHovered, setHovered] = React.useState(false);
  const [isActive, setActive] = React.useState(false);
  const isMobile = useMobile();
  React.useEffect(() => {
    if (isHovered) {
      onHover?.();
    } else {
      onUnhover?.();
    }
  }, [isHovered, onHover, onUnhover]);
  const IconComponent = icon ? iconMap[icon] : void 0;
  const baseStyle = getButtonStyle(
    buttonVariant,
    isHovered,
    isActive,
    isMobile,
    !!IconComponent
  );
  const mergedStyle = getMergedButtonStyle(
    baseStyle,
    ignoreDarkMode,
    customStyle
  );
  const iconContainerStyle = getIconContainerStyle(
    buttonVariant,
    isMobile,
    !!IconComponent
  );
  const iconStyle = getIconStyle(isMobile, isHovered, isActive);
  const contentWrapperStyle = getButtonContentWrapperStyle(isMobile, !!IconComponent);
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("style", null, bounceKeyframes), /* @__PURE__ */ React.createElement(
    "button",
    {
      ...props,
      className,
      onMouseEnter: () => setHovered(true),
      onMouseLeave: () => {
        setHovered(false);
        setActive(false);
      },
      onMouseDown: () => setActive(true),
      onMouseUp: () => setActive(false),
      style: mergedStyle
    },
    IconComponent ? /* @__PURE__ */ React.createElement("div", { style: contentWrapperStyle }, /* @__PURE__ */ React.createElement("div", { style: iconContainerStyle }, /* @__PURE__ */ React.createElement("div", { style: iconStyle }, /* @__PURE__ */ React.createElement(
      IconComponent,
      {
        bgFill: "var(--vibes-button-icon-bg)",
        fill: "var(--vibes-button-icon-fill)",
        width: isMobile ? 28 : 50,
        height: isMobile ? 28 : 50
      }
    ))), /* @__PURE__ */ React.createElement("span", null, children)) : children
  ));
}
// === END VibesButton ===

      // === START VibesPanel ===
      function VibesPanel() {
        return React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: "12px", alignItems: "center", maxWidth: "400px", margin: "0 auto" } },
          React.createElement(VibesButton, { variant: "blue", href: "https://vibes.diy" }, "VISIT VIBES.DIY"),
          React.createElement(VibesButton, { variant: "yellow", href: "https://vibes.diy" }, "CREATE YOUR OWN")
        );
      }
      window.VibesPanel = VibesPanel;
      // === END VibesPanel ===

      // === START useAI ===
      // AI hook for proxied OpenRouter calls with metering
      function useAI() {
        const [loading, setLoading] = React.useState(false);
        const [error, setError] = React.useState(null);

        const callAI = React.useCallback(async (options) => {
          setLoading(true);
          setError(null);

          try {
            // Get auth token from Clerk (sell apps have Clerk)
            let authHeader = {};
            if (typeof window !== 'undefined' && window.Clerk?.session) {
              const token = await window.Clerk.session.getToken();
              if (token) {
                authHeader = { 'Authorization': 'Bearer ' + token };
              }
            }

            const response = await fetch('/api/ai/chat', {
              method: 'POST',
              headers: Object.assign({ 'Content-Type': 'application/json' }, authHeader),
              body: JSON.stringify(Object.assign({
                model: options.model || 'anthropic/claude-sonnet-4',
                messages: options.messages
              }, options))
            });

            // Handle limit exceeded (402 from OpenRouter)
            if (response.status === 402) {
              const err = { code: 'LIMIT_EXCEEDED', message: 'AI usage limit reached for this month.' };
              setError(err);
              throw err;
            }

            // Handle other errors
            if (!response.ok) {
              const errorData = await response.json().catch(function() { return {}; });
              const err = {
                code: 'API_ERROR',
                message: (errorData.error && errorData.error.message) || ('API error: ' + response.status),
                status: response.status
              };
              setError(err);
              throw err;
            }

            return await response.json();

          } catch (err) {
            if (!error) {
              setError({ code: 'NETWORK_ERROR', message: err.message || 'Network error' });
            }
            throw err;
          } finally {
            setLoading(false);
          }
        }, [error]);

        return { callAI: callAI, loading: loading, error: error, clearError: function() { setError(null); } };
      }
      window.useAI = useAI;
      // === END useAI ===
    </script>
    <script type="text/babel" data-type="module">
      import React, { createContext, useContext, useState, useEffect, useRef, useCallback, useMemo, useReducer } from "react";
      import ReactDOMClient from "react-dom/client";
      import { useFireproof } from "use-fireproof";
      // NOTE: Using direct URL because Babel standalone doesn't properly use import maps for bare specifiers
      import {
        ClerkProvider,
        SignedIn,
        SignedOut,
        SignInButton,
        SignUpButton,
        UserButton,
        useUser,
        useAuth
      } from "https://esm.sh/@clerk/clerk-react@5?deps=react@18.3.1,react-dom@18.3.1";

      // === Menu Components from window (defined in module script above) ===
      const HiddenMenuWrapper = window.HiddenMenuWrapper;
      const VibesPanel = window.VibesPanel;
      const VibesSwitch = window.VibesSwitch;
      const VibesButton = window.VibesButton;

      // === Configuration (like mixtape pattern) ===
      const CONFIG = {
        clerkPublishableKey: "__CLERK_PUBLISHABLE_KEY__",
        appName: "__APP_NAME__",
        appTitle: "__APP_TITLE__",
        domain: "__APP_DOMAIN__",
        pricing: {
          monthly: "__MONTHLY_PRICE__",
          yearly: "__YEARLY_PRICE__"
        },
        features: __FEATURES__,
        tagline: "__APP_TAGLINE__",
        adminUserIds: __ADMIN_USER_IDS__
      };

      // Legacy aliases for backward compatibility
      const CLERK_PUBLISHABLE_KEY = CONFIG.clerkPublishableKey;
      const APP_NAME = CONFIG.appName;
      const APP_DOMAIN = CONFIG.domain;
      const MONTHLY_PRICE = CONFIG.pricing.monthly;
      const YEARLY_PRICE = CONFIG.pricing.yearly;
      const FEATURES = CONFIG.features;
      const APP_TAGLINE = CONFIG.tagline;
      const ADMIN_USER_IDS = CONFIG.adminUserIds;

      // === Route Detection ===
      function getRouteInfo() {
        const hostname = window.location.hostname;
        const parts = hostname.split('.');
        const params = new URLSearchParams(window.location.search);
        const testSubdomain = params.get('subdomain');

        // Handle localhost for testing
        if (hostname === 'localhost' || hostname === '127.0.0.1') {
          if (testSubdomain === 'admin') return { route: 'admin', subdomain: null };
          if (testSubdomain) return { route: 'tenant', subdomain: testSubdomain };
          return { route: 'landing', subdomain: null };
        }

        // Handle exe.xyz for testing (before custom domain is set up)
        if (hostname.endsWith('.exe.xyz')) {
          if (testSubdomain === 'admin') return { route: 'admin', subdomain: null };
          if (testSubdomain) return { route: 'tenant', subdomain: testSubdomain };
          return { route: 'landing', subdomain: null };
        }

        // Production: detect subdomain from hostname
        if (parts.length <= 2 || parts[0] === 'www') {
          return { route: 'landing', subdomain: null };
        }
        if (parts[0] === 'admin') {
          return { route: 'admin', subdomain: null };
        }
        return { route: 'tenant', subdomain: parts[0] };
      }

      const routeInfo = getRouteInfo();

      // === Tenant Context ===
      const TenantContext = createContext(null);

      function useTenant() {
        const context = useContext(TenantContext);
        if (!context) throw new Error("useTenant must be used within TenantProvider");
        return context;
      }

      // Make useTenant available globally for the embedded App
      window.useTenant = useTenant;

      function TenantProvider({ children, subdomain }) {
        const dbName = `${APP_NAME}-${subdomain}`;
        return (
          <TenantContext.Provider value={{ subdomain, dbName, appName: APP_NAME, domain: APP_DOMAIN }}>
            {children}
          </TenantContext.Provider>
        );
      }

      // === Subscription Gate ===
      function SubscriptionRequired() {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-50 p-4">
            <div className="max-w-md text-center p-8 bg-white rounded-2xl border border-gray-200 shadow-lg">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Subscription Required</h2>
              <p className="mb-6 text-gray-500">Please subscribe to access this app.</p>
              <a
                href={`https://${APP_DOMAIN}`}
                className="inline-block px-6 py-3 bg-[var(--landing-accent)] text-white font-medium rounded-xl hover:bg-[var(--landing-accent-hover)] transition-colors"
              >
                View Plans
              </a>
            </div>
          </div>
        );
      }

      function SubscriptionGate({ children }) {
        const { has, isLoaded, userId } = useAuth();
        const { user } = useUser();

        if (!isLoaded) {
          return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50">
              <div className="animate-pulse text-lg font-medium text-gray-500">Loading...</div>
            </div>
          );
        }

        // Allow admin users to bypass subscription check
        const isAdmin = ADMIN_USER_IDS.includes(userId);

        // Check Clerk Billing subscriptions (including free plan)
        const hasClerkSubscription = has({ plan: 'pro' }) || has({ plan: 'basic' }) || has({ plan: 'monthly' }) || has({ plan: 'yearly' }) || has({ plan: 'starter' }) || has({ plan: 'free' });

        // Fallback: check user metadata for plan (set during registration)
        const hasMetadataPlan = user?.unsafeMetadata?.plan && ['free', 'pro', 'basic', 'monthly', 'yearly', 'starter'].includes(user.unsafeMetadata.plan);

        const hasSubscription = isAdmin || hasClerkSubscription || hasMetadataPlan;

        if (!hasSubscription) {
          return <SubscriptionRequired />;
        }

        return children;
      }

      // === Tenant Registration (CLIENT-SIDE ONLY - no backend API) ===
      // exe.dev version: Uses only Clerk metadata, no Worker API calls
      function TenantRegistration({ subdomain, children }) {
        const { user, isLoaded } = useUser();
        const [registrationState, setRegistrationState] = useState('checking'); // 'checking' | 'registering' | 'done'

        useEffect(() => {
          if (!isLoaded || !user) return;

          // If user already has a plan in metadata, they're already registered
          if (user.unsafeMetadata?.plan) {
            setRegistrationState('done');
            return;
          }

          // New user - register via Clerk metadata only (no backend API)
          const register = async () => {
            setRegistrationState('registering');
            try {
              console.log(`[TenantRegistration] Registering ${subdomain} for user ${user.id} (client-side only)`);

              // Update Clerk user metadata with the free plan
              // This is the source of truth for exe.dev deployments
              await user.update({
                unsafeMetadata: {
                  ...user.unsafeMetadata,
                  plan: 'free',
                  subdomain: subdomain,
                  registeredAt: new Date().toISOString()
                }
              });

              console.log(`[TenantRegistration] Success: Clerk metadata updated`);
              setRegistrationState('done');
            } catch (err) {
              console.error('[TenantRegistration] Failed to register tenant:', err);
              setRegistrationState('done'); // Don't block app on registration failure
            }
          };

          register();
        }, [isLoaded, user, subdomain]);

        // Show loading state while registering new users
        if (registrationState === 'checking' || registrationState === 'registering') {
          return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50">
              <div className="text-center">
                <div className="animate-pulse text-lg font-medium text-gray-600 mb-2">
                  Setting up your studio...
                </div>
                <p className="text-sm text-gray-400">This will only take a moment</p>
              </div>
            </div>
          );
        }

        return children;
      }

      // === Original App Code (embedded during assembly) ===
      // __VIBES_APP_CODE__

      // === Sign In Screen (for tenant) ===
      function SignInScreen({ subdomain }) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-50 p-4">
            <div className="max-w-md text-center p-8 bg-white rounded-2xl border border-gray-200 shadow-lg">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Welcome to {subdomain}</h2>
              <p className="mb-6 text-gray-500">Sign in with your passkey to continue</p>
              <SignInButton mode="modal">
                <button className="w-full px-6 py-3 bg-[var(--landing-accent)] text-white font-medium rounded-xl hover:bg-[var(--landing-accent-hover)] transition-colors">
                  Sign In with Passkey
                </button>
              </SignInButton>
              <p className="mt-4 text-sm text-gray-500">
                Don't have an account?{' '}
                <a href={`https://${APP_DOMAIN}`} className="text-[var(--landing-accent)] hover:underline font-medium">
                  Create one
                </a>
              </p>
            </div>
          </div>
        );
      }

      // === Tenant App Wrapper ===
      function TenantApp({ subdomain }) {
        return (
          <ClerkProvider publishableKey={CLERK_PUBLISHABLE_KEY} afterSignOutUrl={`https://${APP_DOMAIN}`}>
            <TenantProvider subdomain={subdomain}>
              <SignedIn>
                <TenantRegistration subdomain={subdomain}>
                  <SubscriptionGate>
                    <HiddenMenuWrapper menuContent={<VibesPanel />}>
                      <div className="relative">
                        <div className="fixed top-4 right-4 z-50">
                          <UserButton />
                        </div>
                        <App />
                      </div>
                    </HiddenMenuWrapper>
                  </SubscriptionGate>
                </TenantRegistration>
              </SignedIn>
              <SignedOut>
                <SignInScreen subdomain={subdomain} />
              </SignedOut>
            </TenantProvider>
          </ClerkProvider>
        );
      }

      // === Admin Components (CLIENT-SIDE ONLY - no backend API) ===
      __ADMIN_CODE__

      // === Landing Page Components ===
      // NOTE: Prefixed with underscore to avoid conflicts with user's app.jsx components
      function _SellHero({ onGetStarted }) {
        const [subdomain, setSubdomain] = useState('');

        const handleGetStarted = () => {
          if (subdomain) {
            onGetStarted(subdomain);
          }
        };

        return (
          <section className="max-w-4xl mx-auto px-6 pt-16 pb-20">
            <div className="max-w-2xl">
              <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold text-[var(--landing-accent)] leading-[1.1] tracking-tight mb-6">
                {APP_TAGLINE}
              </h1>
              <p className="text-lg text-gray-500 mb-10 leading-relaxed">
                Your own subdomain. Your own space. Get started in seconds.
              </p>

              <div className="flex flex-col sm:flex-row gap-3 max-w-xl">
                <div className="flex-1 flex items-center bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
                  <input
                    type="text"
                    placeholder="yourname"
                    value={subdomain}
                    onChange={(e) => setSubdomain(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, ''))}
                    onKeyDown={(e) => e.key === 'Enter' && handleGetStarted()}
                    className="flex-1 px-4 py-3.5 bg-transparent text-gray-800 placeholder-gray-400 focus:outline-none"
                  />
                  <span className="pr-4 text-gray-400 text-sm whitespace-nowrap">.{APP_DOMAIN}</span>
                </div>
                <button
                  onClick={handleGetStarted}
                  disabled={!subdomain}
                  className="px-6 py-3.5 bg-[var(--landing-accent)] text-white font-medium rounded-xl hover:bg-[var(--landing-accent-hover)] disabled:opacity-40 disabled:cursor-not-allowed transition-all shadow-sm"
                >
                  Get Started
                </button>
              </div>
            </div>
          </section>
        );
      }

      // === localStorage helpers for pending subdomain ===
      const PENDING_SUBDOMAIN_KEY = `${APP_NAME}_pending_subdomain`;

      function savePendingSubdomain(subdomain) {
        if (subdomain) localStorage.setItem(PENDING_SUBDOMAIN_KEY, subdomain);
      }

      function getPendingSubdomain() {
        return localStorage.getItem(PENDING_SUBDOMAIN_KEY);
      }

      function clearPendingSubdomain() {
        localStorage.removeItem(PENDING_SUBDOMAIN_KEY);
      }

      // === Cookie helpers for cross-session "welcome back" ===
      const LAST_SUBDOMAIN_COOKIE = `${APP_NAME}_last_subdomain`;

      function setLastSubdomainCookie(subdomain) {
        if (subdomain) {
          // Cookie lasts 1 year, accessible on root domain
          document.cookie = `${LAST_SUBDOMAIN_COOKIE}=${subdomain}; max-age=31536000; path=/; domain=.${APP_DOMAIN}`;
        }
      }

      function getLastSubdomainCookie() {
        const cookie = document.cookie.split('; ').find(c => c.startsWith(`${LAST_SUBDOMAIN_COOKIE}=`));
        return cookie ? cookie.split('=')[1] : null;
      }

      // === OnboardingFlow (replaces CheckoutFlow) ===
      function _SellOnboardingFlow({ subdomain: preClaimedSubdomain, onBack }) {
        const { user, isLoaded } = useUser();
        const [activating, setActivating] = useState(false);
        const [localSubdomain, setLocalSubdomain] = useState(preClaimedSubdomain || '');

        // Save subdomain to localStorage whenever it changes
        useEffect(() => {
          if (localSubdomain) {
            savePendingSubdomain(localSubdomain);
          }
        }, [localSubdomain]);

        // Restore from localStorage if not provided
        useEffect(() => {
          if (!localSubdomain) {
            const pending = getPendingSubdomain();
            if (pending) setLocalSubdomain(pending);
          }
        }, []);

        const activateSubdomain = useCallback(async (subdomain) => {
          if (!user || !subdomain || activating) return;

          setActivating(true);
          try {
            await user.update({
              unsafeMetadata: {
                ...user.unsafeMetadata,
                subdomain: subdomain,
                plan: 'free',
                registeredAt: new Date().toISOString()
              }
            });
            clearPendingSubdomain();
            // Set cookie for "welcome back" on future visits
            setLastSubdomainCookie(subdomain);
            window.location.href = `https://${subdomain}.${APP_DOMAIN}`;
          } catch (err) {
            console.error('Error activating subdomain:', err);
            setActivating(false);
            alert('Failed to activate. Please try again.');
          }
        }, [user, activating]);

        // Auto-activate when user signs in with a pending subdomain
        // Note: Pending subdomain takes precedence - user explicitly claimed a new one
        useEffect(() => {
          if (!isLoaded || !user || activating) return;

          const pendingSubdomain = localSubdomain || getPendingSubdomain();
          if (pendingSubdomain) {
            activateSubdomain(pendingSubdomain);
          }
        }, [isLoaded, user, localSubdomain, activating, activateSubdomain]);

        // Show loading state while activating
        if (activating) {
          return (
            <section className="py-16 px-6 max-w-lg mx-auto">
              <div className="p-8 bg-white rounded-2xl border border-gray-200 shadow-lg text-center">
                <div className="animate-pulse text-lg font-medium text-gray-600 mb-2">
                  Setting up your studio...
                </div>
                <p className="text-sm text-gray-400">Preparing {localSubdomain || getPendingSubdomain()}.{APP_DOMAIN}</p>
              </div>
            </section>
          );
        }

        return (
          <section className="py-16 px-6 max-w-lg mx-auto">
            <div className="p-8 bg-white rounded-2xl border border-gray-200 shadow-lg">
              <button onClick={onBack} className="mb-6 text-gray-500 hover:text-gray-900 font-medium flex items-center gap-2">
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
                Back
              </button>

              {/* Subdomain display */}
              <div className="mb-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
                <p className="text-sm text-gray-600 font-medium mb-1">Your subdomain</p>
                <p className="text-lg font-bold text-gray-900">{localSubdomain}.{APP_DOMAIN}</p>
              </div>

              <div className="mb-6 pb-6 border-b border-gray-100">
                <span className="inline-block px-3 py-1 bg-green-100 text-green-700 text-sm font-medium rounded-full mb-2">Free Forever</span>
                <p className="text-gray-500">Your own subdomain, unlimited hosting</p>
              </div>

              <SignedOut>
                <p className="mb-4 text-gray-600 text-center">Create your account with passkey:</p>
                <div className="space-y-3">
                  <SignUpButton mode="modal">
                    <button className="w-full px-6 py-3.5 bg-[var(--landing-accent)] text-white font-medium rounded-xl hover:bg-[var(--landing-accent-hover)] transition-colors">
                      Create Account with Passkey
                    </button>
                  </SignUpButton>
                  <SignInButton mode="modal">
                    <button className="w-full px-6 py-3 bg-white text-gray-900 font-medium rounded-xl border border-gray-200 hover:bg-gray-50 transition-colors">
                      Already have an account? Sign In
                    </button>
                  </SignInButton>
                </div>
              </SignedOut>

              <SignedIn>
                <button
                  onClick={() => activateSubdomain(localSubdomain)}
                  disabled={activating || !localSubdomain}
                  className="w-full px-6 py-3.5 bg-[var(--landing-accent)] text-white font-medium rounded-xl hover:bg-[var(--landing-accent-hover)] disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                >
                  Enter Your Studio
                </button>
              </SignedIn>
            </div>
          </section>
        );
      }

      // === Features Section ===
      function _SellFeaturesSection() {
        return (
          <section className="py-16 px-6 max-w-4xl mx-auto">
            <h2 className="text-2xl font-bold text-center text-gray-900 mb-10">Everything you need</h2>
            <div className="grid md:grid-cols-3 gap-6">
              {FEATURES.slice(0, 6).map((feature, i) => (
                <div key={i} className="p-5 bg-white rounded-xl border border-gray-200">
                  <div className="w-10 h-10 bg-[var(--landing-accent)]/10 rounded-lg flex items-center justify-center mb-3">
                    <svg className="w-5 h-5 text-[var(--landing-accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                    </svg>
                  </div>
                  <p className="text-gray-700 font-medium">{feature}</p>
                </div>
              ))}
            </div>
          </section>
        );
      }

      // === Landing Page Content (inside ClerkProvider) ===
      function _SellLandingPageContent() {
        const { user, isLoaded } = useUser();
        const [showOnboarding, setShowOnboarding] = useState(false);
        const [claimedSubdomain, setClaimedSubdomain] = useState(null);
        const [redirecting, setRedirecting] = useState(false);

        // Check for pending subdomain on load
        useEffect(() => {
          if (!isLoaded) return;

          const pending = getPendingSubdomain();
          // If there's a pending subdomain and user is signed in, show onboarding
          // (pending subdomain takes precedence - user explicitly claimed a new one)
          if (user && pending) {
            setClaimedSubdomain(pending);
            setShowOnboarding(true);
          }
        }, [isLoaded, user]);

        const handleGetStarted = (subdomain) => {
          savePendingSubdomain(subdomain);
          setClaimedSubdomain(subdomain);
          setShowOnboarding(true);
        };

        const handleBack = () => {
          setShowOnboarding(false);
          clearPendingSubdomain();
          setClaimedSubdomain(null);
        };

        // Get subdomain from metadata or cookie
        const userSubdomain = user?.unsafeMetadata?.subdomain || getLastSubdomainCookie();

        const handleGoToStudio = () => {
          if (userSubdomain) {
            setRedirecting(true);
            window.location.href = `https://${userSubdomain}.${APP_DOMAIN}`;
          }
        };

        // Show redirecting state
        if (redirecting) {
          return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50">
              <div className="text-center">
                <div className="animate-pulse text-lg font-medium text-gray-600 mb-2">
                  Taking you to your studio...
                </div>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen bg-gray-50">
            <header className="flex justify-between items-center px-6 py-4 max-w-6xl mx-auto">
              <div className="font-semibold text-lg text-gray-900">
                {APP_NAME.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase())}
              </div>
              <nav>
                <SignedOut>
                  <div className="flex gap-3 items-center">
                    <SignInButton mode="modal">
                      <button className="px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors">Sign In with Passkey</button>
                    </SignInButton>
                  </div>
                </SignedOut>
                <SignedIn>
                  <div className="flex gap-3 items-center">
                    {userSubdomain && (
                      <button
                        onClick={handleGoToStudio}
                        className="px-4 py-2 bg-[var(--landing-accent)] text-white font-medium rounded-lg hover:bg-[var(--landing-accent-hover)] transition-colors"
                      >
                        My Studio
                      </button>
                    )}
                    <UserButton />
                  </div>
                </SignedIn>
              </nav>
            </header>

            {!showOnboarding ? (
              <>
                {/* Welcome back banner - shows ABOVE hero for returning users */}
                {userSubdomain && (
                  <div className="bg-gradient-to-r from-[var(--landing-accent)] to-[var(--landing-accent-hover)] text-white">
                    <div className="max-w-4xl mx-auto px-6 py-4">
                      <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div className="text-center sm:text-left">
                          <h2 className="text-lg font-semibold">Welcome back!</h2>
                          <p className="text-white/80">
                            <strong className="text-white">{userSubdomain}.{APP_DOMAIN}</strong> is ready for you
                          </p>
                        </div>
                        <button
                          onClick={handleGoToStudio}
                          className="px-6 py-2.5 bg-white text-[var(--landing-accent)] font-medium rounded-xl hover:bg-gray-100 transition-colors whitespace-nowrap"
                        >
                          Enter Your Studio
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Hero ALWAYS shows - allows claiming additional subdomains */}
                <_SellHero onGetStarted={handleGetStarted} />

                {/* Features grid */}
                <_SellFeaturesSection />
              </>
            ) : (
              <_SellOnboardingFlow subdomain={claimedSubdomain} onBack={handleBack} />
            )}

            <footer className="py-8 px-6 text-center text-gray-400 border-t border-gray-200 mt-16">
              <p>Built with <a href="https://vibes.diy" className="text-[var(--landing-accent)] hover:underline">Vibes DIY</a></p>
            </footer>
          </div>
        );
      }

      // === Landing Page Wrapper ===
      function _SellLandingPage() {
        return (
          <ClerkProvider publishableKey={CLERK_PUBLISHABLE_KEY} afterSignOutUrl="/">
            <_SellLandingPageContent />
          </ClerkProvider>
        );
      }

      // === Main Router ===
      function AppRouter() {
        if (routeInfo.route === 'admin') {
          return <AdminApp />;
        }
        if (routeInfo.route === 'tenant') {
          return <TenantApp subdomain={routeInfo.subdomain} />;
        }
        return <_SellLandingPage />;
      }

      // Render
      const rootElement = document.getElementById("container");
      ReactDOMClient.createRoot(rootElement).render(<AppRouter />);
    </script>
  </body>
</html>
